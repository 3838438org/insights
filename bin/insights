#!/usr/bin/env node

// Thanks to https://github.com/mysamai/mysam/blob/master/bin/mysam for this script!

var path = require('path')
var program = require('commander')
var root = path.join(__dirname, '..')
var pkg = require(path.join(root, 'package.json'))
var electron = require('electron')
var proc = require('child_process')

var electronScript = path.join(root, 'server', 'electron')

program.version(pkg.version)
  .usage('[options]')
  .description(pkg.description)
  .option('-s, --server', 'Run server only')
  .option('-p, --port [number]', 'Port in server mode. Defaults to 3030')
  .option('-d --develop', 'Run in development mode')
  .parse(process.argv)

process.env.NODE_ENV = program.develop ? 'development' : 'production'
process.env.NODE_CONFIG_DIR = path.join(__dirname, '..', 'config')

if (program.server) {
  if (program.port) {
    process.env.INSIGHTS_PORT = program.port
  }
  require('../server')
} else {
  proc.spawn(electron, [electronScript], {stdio: 'inherit'})
}
